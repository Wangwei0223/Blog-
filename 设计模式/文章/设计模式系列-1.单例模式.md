### 设计模式系列-1.单例模式

今天并行更新JS和设计模式... CSS先放一放吧...面试要紧..CSS会布局动画变形基本知识就差不多, 答不上来也不算硬伤..JS和设计模式答不上来就是硬伤了

为什么要强调设计模式..太重要了这玩意..有的时候反思我为什么看不懂大神写的代码..一方面就是不懂设计模式..或者反应不出来这玩意到底是什么设计模式(还是一种方式的不懂阿...)

这点放在JS更明显了...为什么说前端入门容易精通难...入门容易毕竟写的再天花乱坠也逃不出浏览器和HTTP协议.(Node.js单说...内核V8按说也没逃出浏览器..). 精通难一方面是兼容性(IE也要挣钱啊), 一方面就是JS的难度了...

我认为, JS绝对算得上难度大的语言..难的不在语法..其实语法难是有好处的..就是大家的代码规范被限制在语法中了..而JS...基本没有语法的束缚..ES5, 6甚至7开始乱飞..各种标准混用(webpack)....

所以就造成一个现象..两个人写的JS..看起来比两种语言差距还大...更可怕的是..如果这两个人都不懂设计模式.......

所以约束我们和让我避免采坑的方法, 就是设计模式..

> 大部分资料出自网络..提纲按照汤姆大叔的来
#### 单例模式
一个类只有一个实例
##### 一般定义类: 缺点是暴露属性
```js
var obj = {
	property: '1',
	property_:'2',
	show: function(){
		return this.property + this.property_;
	}
}
```
##### 闭包改进
```js
var getObj  = function(salary){
	var salary = salary || 0;
	return {
		publicVar : '1',
		getSalary: function(){
			return salary;
		}
	}
}
```
##### 再改进
上面的代码很不错了，但如果我们想做到只有在使用的时候才初始化，那该如何做呢？为了节约资源的目的，我们可以另外一个构造函数里来初始化这些代码，如下：

##### IIFE 初始化形式
```js
var mySingleton_1 = (function(salary){
    var instance; // 判断是否已经形成单例
    var init = function(){ // 单例初始化
        return {
            public_var: 'public',
            getSalary: function(){
                return salary + this.public_var;
            }
        }
    }

    return {
        getInstance:function(){
            if(!instance){
                instance = init(salary);
            }
            return instance;
        }
    }
})(5000);

console.log(mySingleton_1.getInstance().getSalary()); //5000

mySingleton_1.getInstance().public_var = 2;
console.log(mySingleton_1.getInstance().getSalary()); //5002

console.log(mySingleton_1.getInstance() === mySingleton_1.getInstance()); // true
```

##### 别的方法实现单例 new构造函数形式
```javascript
// 其他方法

var Single = function(a, b){
    if(Single.instance){
        return Single.instance;
    }
    var var_1 = a || 0;
    var var_2 = b || 0;
    this.getVar = function(){ // 想暴露的用this定义成属性, 不想暴露的写在变量里闭包用属性方法去访问
        return var_1 + var_2;
    }
    Single.instance = this;
}

var u1 = new Single(1, 2);
var u2 = new Single();
console.log(u1 === u2); // true
console.log(u1.getVar(), u2.getVar()) // 3 3;
```
